import{a as k,m as h,f as T,b as I,c as m,u as v,d as P,h as H}from"./header-B8ZBBv48.js";function te(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}let b=null;function E(t){b&&u();const s=z();if(s[t]){const e=s[t],i=L.divIcon({className:"highlighted-marker",html:'<img src="https://paulbrsv.github.io/goodplaces/image/mark.svg" style="width: 48px; height: 48px;">',iconSize:[48,48],iconAnchor:[24,12]});e.setIcon(i),b=e,$().setView(e.getLatLng(),$().getZoom(),{animate:!0})}}function u(){if(b){const t=L.divIcon({className:"default-marker",html:'<div style="background-color: #3388ff; width: 10px; height: 10px; border-radius: 50%; border: 3px solid #ffffff; box-shadow: 0 0 0 2px #3388ff;"></div>',iconSize:[16,16],iconAnchor:[8,8]});b.setIcon(t),b=null}}function A(t,s){let e=t.querySelector(".custom-tooltip");e||(e=document.createElement("div"),e.className="custom-tooltip",e.textContent=s,t.appendChild(e));const i=t.getBoundingClientRect(),a=e.offsetWidth,o=window.innerWidth;e.style.top="-".concat(e.offsetHeight+5,"px");let c=(t.offsetWidth-a)/2;const l=i.left;l+c<0?c=-l+5:l+c+a>o&&(c=o-l-a-5),e.style.left="".concat(c,"px"),e.style.visibility="visible",setTimeout(()=>{e.style.visibility="hidden"},3e3)}function N(t){const s=t.querySelector(".custom-tooltip");s&&(s.style.visibility="hidden")}function _(t){const s=document.getElementById("visible-places"),e=document.getElementById("outside-places");s.innerHTML="",e.innerHTML="";const i=$(),a=i.getBounds(),o=i.getCenter(),c=t.map(n=>{const d=L.latLng(n.lat,n.lng),p=o.distanceTo(d);return{...n,distance:p}}).sort((n,d)=>n.distance-d.distance);let l=null;c.forEach(n=>{const d=document.createElement("div");d.className="place",d.innerHTML='\n      <img src="'.concat(n.image,'" alt="').concat(n.name,'">\n      <div class="place-info">\n        <h3>').concat(n.name,"</h3>\n        <p>").concat(n.shirt_description||n.description,"</p>\n        <p>").concat(n.attributes.map(p=>k[p]||p).join(""),"</p>\n      </div>\n    "),d.onclick=()=>{if(window.innerWidth<=768)i.setView([n.lat,n.lng],17,{animate:!0}),W(n),F(),E(n.name);else{l&&(l.isPopupOpen()&&l.closePopup(),i.removeLayer(l),l=null);const p='\n          <div class="popup-content">\n            <img src="'.concat(n.image,'" alt="').concat(n.name,'">\n            <div class="popup-text">\n              <div class="popup-text-content">\n                <h3>').concat(n.name,"</h3>\n                <p>").concat(n.description,'</p>\n                <div class="popup-attributes">').concat(n.attributes.map(C=>k[C]||C).join(""),'</div>\n              </div>\n              <div class="popup-links">\n                <a href="').concat(n.instagram,'" target="_blank">\n                  <img src="https://paulbrsv.github.io/goodplaces/image/instagram.svg" alt="Instagram" class="icon">\n                </a>\n                <a href="').concat(n.maps_url,'" target="_blank">\n                  <img src="https://paulbrsv.github.io/goodplaces/image/google.svg" alt="Google Maps" class="icon">\n                </a>\n              </div>\n            </div>\n          </div>\n        ');l=L.marker([n.lat,n.lng],{icon:L.divIcon({className:"highlighted-marker",html:'<img src="https://paulbrsv.github.io/goodplaces/image/mark.svg" style="width: 48px; height: 48px;">',iconSize:[48,48],iconAnchor:[24,12]})}),l.bindPopup(p,{autoPan:!0,autoPanPaddingTopLeft:L.point(0,100),autoPanPaddingBottomRight:L.point(0,50)}),l.addTo(i).openPopup(),i.setView([n.lat,n.lng],17,{animate:!0}),E(n.name),l.on("popupclose",()=>{i.removeLayer(l),l=null,u()})}},a.contains([n.lat,n.lng])?s.appendChild(d):e.appendChild(d)})}function W(t){const s=document.getElementById("mobile-place-card"),e=s.querySelector(".mobile-place-card-header"),i=s.querySelector(".mobile-place-card-content"),a=t.attributes.map(o=>k[o]||o).join("");e.innerHTML='\n    <div class="mobile-place-card-attributes">'.concat(a,'</div>\n    <span class="close-card">✕</span>\n  '),i.innerHTML='\n    <img src="'.concat(t.image,'" alt="').concat(t.name,'">\n    <div class="popup-text">\n      <div class="popup-text-content">\n        <h3>').concat(t.name,"</h3>\n        <p>").concat(t.description,'</p>\n      </div>\n      <div class="popup-links">\n        <a href="').concat(t.instagram,'" target="_blank"><img src="https://paulbrsv.github.io/goodplaces/image/instagram.svg" alt="Instagram" class="icon"></a>\n        <a href="').concat(t.maps_url,'" target="_blank"><img src="https://paulbrsv.github.io/goodplaces/image/google.svg" alt="Google Maps" class="icon"></a>\n      </div>\n    </div>\n  '),s.classList.remove("hidden"),s.classList.add("active")}function F(){const t=document.getElementById("sidebar"),s=document.querySelector(".mobile-sidebar-close"),e=document.querySelector(".mobile-list-toggle");t.style.transform="translateX(-100%)",s.style.display="none",window.innerWidth<=768&&(e.style.display="block"),u()}let f,w=L.markerClusterGroup(),B={},y=[];function j(){return new Promise((t,s)=>{f=L.map("map").setView(h.initialCoords,h.initialZoom),L.tileLayer(h.tileLayerUrl,{attribution:h.attribution}).addTo(f),f.addLayer(w),fetch("/places.json").then(e=>e.json()).then(e=>{y=e,S(q()),t()}).catch(e=>{console.error("Ошибка загрузки данных:",e),s(e)}),f.on("moveend",()=>{y.length&&_(y.filter(e=>{const i=q();return i.length===0?!0:e.attributes.some(a=>i.includes(a))}))})})}function S(t){if(!f||!y.length){console.warn("Map or places data not ready yet, skipping updateMap");return}w.clearLayers();const s=y.filter(e=>t.length===0?!0:t.every(i=>e.attributes.includes(i)));s.forEach(e=>{const i='\n      <div class="popup-content">\n        <img src="'.concat(e.image,'" alt="').concat(e.name,'">\n        <div class="popup-text">\n          <div class="popup-text-content">\n            <h3>').concat(e.name,"</h3>\n            <p>").concat(e.description,'</p>\n            <div class="popup-attributes">').concat(e.attributes.map(o=>k[o]||o).join(""),'</div>\n          </div>\n          <div class="popup-links">\n            <a href="').concat(e.instagram,'" target="_blank">\n              <img src="https://paulbrsv.github.io/goodplaces/image/instagram.svg" alt="Instagram" class="icon">\n            </a>\n            <a href="').concat(e.maps_url,'" target="_blank">\n              <img src="https://paulbrsv.github.io/goodplaces/image/google.svg" alt="Google Maps" class="icon">\n            </a>\n          </div>\n        </div>\n      </div>\n    '),a=L.marker([e.lat,e.lng],{icon:L.divIcon({className:"default-marker",html:'<div style="background-color: #3388ff; width: 10px; height: 10px; border-radius: 50%; border: 3px solid #ffffff; box-shadow: 0 0 0 2px #3388ff;"></div>',iconSize:[16,16],iconAnchor:[8,8]})});window.innerWidth>768?(a.bindPopup(i,{autoPan:!0,autoPanPaddingTopLeft:L.point(0,100),autoPanPaddingBottomRight:L.point(0,50)}),a.on("popupopen",()=>E(e.name)),a.on("popupclose",()=>u())):a.on("click",()=>{R(e),E(e.name)}),w.addLayer(a),B[e.name]=a}),f.addLayer(w),_(s),V(s)}function V(t){document.querySelectorAll(".filter").forEach(s=>{const e=s.dataset.filter;if(!e)return;const i=t.filter(o=>o.attributes.includes(e)).length;let a=s.querySelector(".filter-count");a||(a=document.createElement("div"),a.classList.add("filter-count"),s.appendChild(a)),a.textContent=i})}function R(t){const s=document.getElementById("mobile-place-card"),e=s.querySelector(".mobile-place-card-header"),i=s.querySelector(".mobile-place-card-content"),a=t.attributes.map(o=>k[o]||o).join("");e.innerHTML='\n    <div class="mobile-place-card-attributes">'.concat(a,'</div>\n    <span class="close-card">✕</span>\n  '),i.innerHTML='\n    <img src="'.concat(t.image_VAL,'" alt="').concat(t.name,'">\n    <div class="popup-text">\n      <div class="popup-text-content">\n        <h3>').concat(t.name,"</h3>\n        <p>").concat(t.description,'</p>\n      </div>\n      <div class="popup-links">\n        <a href="').concat(t.instagram,'" target="_blank"><img src="https://paulbrsv.github.io/goodplaces/image/instagram.svg" alt="Instagram" class="icon"></a>\n        <a href="').concat(t.maps_url,'" target="_blank"><img src="https://paulbrsv.github.io/goodplaces/image/google.svg" alt="Google Maps" class="icon"></a>\n      </div>\n    </div>\n  '),s.classList.remove("hidden"),s.classList.add("active")}function z(){return B}function $(){return f}let r=[];function D(){document.querySelectorAll(".filter").forEach(t=>{var a,o;const s=t.dataset.filter;if(!s)return;t.innerHTML="";const e=document.createElement("span");e.className="filter-icon-wrapper";const i=document.createElement("img");i.src=T[s]||"https://via.placeholder.com/16",i.alt=((a=I[s])==null?void 0:a[m])||s,i.className="filter-icon",e.appendChild(i),t.appendChild(e),t.appendChild(document.createTextNode(((o=I[s])==null?void 0:o[m])||s)),t.addEventListener("click",()=>{r.includes(s)?(r=r.filter(c=>c!==s),t.classList.remove("active")):(r.push(s),t.classList.add("active")),u(),S(r),x()}),r.includes(s)&&t.classList.add("active")}),document.querySelectorAll(".filter-reset").forEach(t=>{t.addEventListener("click",()=>{r=[],document.querySelectorAll(".filter").forEach(s=>s.classList.remove("active")),u(),$().setView(h.initialCoords,h.initialZoom),S(r),x()})})}function G(t){r=t.filter(s=>T[s]),console.log("Setting active filters:",r),r.forEach(s=>{const e=document.querySelector('.filter[data-filter="'.concat(s,'"]'));e?(console.log("Activating filter: ".concat(s)),e.classList.add("active")):console.warn('Filter "'.concat(s,'" not found in DOM'))}),r.length>0&&(S(r),x())}function U(){document.querySelectorAll(".filter").forEach(t=>{const s=t.dataset.filter;s&&(r.includes(s)?(console.log("Updating visual state for: ".concat(s)),t.classList.add("active")):t.classList.remove("active"))})}function q(){return r}function x(){const t=new URL(window.location);r.length>0?t.search="?filter=".concat(r.join(",")):t.search="",window.history.pushState({},document.title,t)}function X(){document.querySelector(".mobile-list-toggle").addEventListener("click",()=>{const e=document.getElementById("sidebar"),i=document.querySelector(".mobile-sidebar-close");e.style.transform==="translateX(-100%)"||e.classList.contains("hidden-mobile")?(e.style.transform="translateX(0)",e.classList.remove("hidden-mobile"),e.scrollTop=0,window.innerWidth<=768&&(i.style.display="flex",document.querySelector(".mobile-list-toggle").style.display="none")):M()}),document.querySelector(".mobile-sidebar-close").addEventListener("click",M),document.getElementById("mobile-place-card").addEventListener("click",e=>{if(e.target.classList.contains("close-card")){const i=document.getElementById("mobile-place-card");i.classList.remove("active"),setTimeout(()=>{i.classList.add("hidden"),u()},300)}});const t=document.querySelector(".mobile-list-toggle"),s=()=>{window.innerWidth>768?t.style.display="none":t.style.display="block"};s(),window.addEventListener("resize",s)}function M(){const t=document.getElementById("sidebar"),s=document.querySelector(".mobile-sidebar-close"),e=document.querySelector(".mobile-list-toggle");t.style.transform="translateX(-100%)",s.style.display="none",window.innerWidth<=768&&(e.style.display="block"),u()}function O(){document.querySelector(".more-filters-btn").addEventListener("click",()=>{document.getElementById("more-filters-modal").classList.remove("hidden")}),document.querySelector(".close-modal").addEventListener("click",()=>{document.getElementById("more-filters-modal").classList.add("hidden")})}const Z='<div class="filters">\n  <div class="filters-mobile">\n    <div class="filter-row">\n      <span class="filter" data-filter="no_smoking"></span>\n      <span class="filter" data-filter="terrace"></span>\n      <span class="more-filters-btn">\n        <!-- Текст "Ещё" добавится через JS -->\n      </span>\n    </div>\n    <div class="filter-row">\n      <span class="filter" data-filter="coffee_shop"></span>\n      <span class="filter" data-filter="breakfast"></span>\n      <span class="filter" data-filter="bar"></span>\n      <span class="filter-reset">\n        <img src="https://paulbrsv.github.io/goodplaces/image/reset.svg" alt="Reset" class="filter-icon">\n      </span>\n    </div>\n  </div>\n  <div class="filters-left">\n    <span class="filter" data-filter="no_smoking"></span>\n    <span class="filter" data-filter="pets_allowed"></span>\n    <span class="filter" data-filter="terrace"></span>\n    <span class="filter" data-filter="smoke"></span>\n\n  </div>\n  <span class="filter-divider"></span>\n  <div class="filters-right">\n    <span class="filter" data-filter="coffee_shop"></span>\n    <span class="filter" data-filter="specialty"></span>\n    <span class="filter" data-filter="food"></span>\n    <span class="filter" data-filter="bar"></span>\n    <span class="filter" data-filter="desserts"></span>\n    <span class="filter" data-filter="breakfast"></span>\n    <span class="filter" data-filter="cafe"></span>\n    <span class="filter" data-filter="vegan"></span>\n    <span class="filter" data-filter="snacks"></span>\n    <span class="filter" data-filter="beans_sale"></span>\n    <span class="filter" data-filter="ice_cream"></span>\n    <span class="filter" data-filter="beer"></span>\n    <span class="filter" data-filter="wine"></span>\n  </div>\n  <span class="filter-reset desktop-reset">\n    <img src="https://paulbrsv.github.io/goodplaces/image/reset.svg" alt="Reset" class="filter-icon">\n  </span>\n</div>\n',J='<div id="sidebar" class="hidden-mobile">\n  <div class="place-list">\n    <h3>В этом районе</h3>\n    <div id="visible-places"></div>\n  </div>\n  <div class="place-list">\n    <h3>📍 Ещё рядом</h3>\n    <div id="outside-places"></div>\n  </div>\n</div>\n',K='<div id="map"></div>\n',Q='<button class="mobile-sidebar-close" style="display: none;">\n  <img src="https://paulbrsv.github.io/goodplaces/image/close.svg" alt="Close" class="icon">\n  Закрыть\n</button>\n<div class="mobile-list-toggle">\n  <img src="https://paulbrsv.github.io/goodplaces/image/list.svg" alt="List" class="icon">\n  Показать список\n</div>\n<div id="mobile-place-card" class="mobile-place-card hidden">\n  <div class="mobile-place-card-header">\n    <div class="mobile-place-card-attributes"></div>\n    <span class="close-card">✕</span>\n  </div>\n  <div class="mobile-place-card-content"></div>\n</div>\n',Y='<div id="more-filters-modal" class="modal hidden">\n  <div class="modal-content">\n    <span class="close-modal">✕</span>\n    <div class="extra-filters">\n      <div class="extra-filters-top">\n        <span class="filter" data-filter="smoke"></span>\n        <span class="filter" data-filter="pets_allowed"></span>\n      </div>\n      <span class="filter-divider-horizontal"></span>\n      <div class="extra-filters-bottom">\n        <span class="filter" data-filter="specialty"></span>\n        <span class="filter" data-filter="food"></span>\n        <span class="filter" data-filter="desserts"></span>\n        <span class="filter" data-filter="cafe"></span>\n        <span class="filter" data-filter="vegan"></span>\n        <span class="filter" data-filter="snacks"></span>\n        <span class="filter" data-filter="wine"></span>\n        <span class="filter" data-filter="beans_sale"></span>\n        <span class="filter" data-filter="ice_cream"></span>\n        <span class="filter" data-filter="beer"></span>\n\n      </div>\n    </div>\n  </div>\n</div>\n';function g(t,s){document.getElementById(t).innerHTML=s}async function ee(){g("header-container",H),g("filters-container",Z),g("sidebar-container",J),g("map-container",K),g("mobile-container",Q),g("modal-container",Y);const t=document.getElementById("filters-container");document.getElementById("filters-placeholder").appendChild(t.querySelector(".filters")),t.innerHTML="",document.querySelector("h1").textContent=v.headerTitle[m],document.querySelector(".mobile-list-toggle").lastChild.textContent=v.showListButton[m],document.querySelector(".mobile-sidebar-close").lastChild.textContent=v.closeButton[m];const e=document.querySelector(".more-filters-btn");e.innerHTML="";const i=document.createElement("img");i.src="https://paulbrsv.github.io/goodplaces/image/more.svg",i.alt=v.moreFilters[m],i.className="filter-icon",e.appendChild(i),e.appendChild(document.createTextNode(v.moreFilters[m])),D(),await j(),X(),O();const o=new URLSearchParams(window.location.search).get("filter");if(o){const l=o.split(",");G(l)}U(),document.querySelectorAll(".filter").forEach(l=>{const n=l.dataset.filter;if(!n)return;const p=(P[n]||{})[m]||"Description unavailable";l.addEventListener("mouseenter",()=>A(l,p)),l.addEventListener("mouseleave",()=>N(l))})}document.addEventListener("DOMContentLoaded",ee);export{te as __vite_legacy_guard};
