import{a as w,m as v,f as B,b as M,c as u,u as b,d as N,h as W}from"./header-B8ZBBv48.js";function ie(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}let y=null;function S(t){y&&f();const s=H();if(s[t]){const e=s[t],i=L.divIcon({className:"highlighted-marker",html:'<img src="https://paulbrsv.github.io/goodplaces/image/mark.svg" style="width: 48px; height: 64px;">',iconSize:[48,48],iconAnchor:[24,48]});e.setIcon(i),y=e,x().setView(e.getLatLng(),x().getZoom(),{animate:!0})}}function f(){if(y){const t=L.divIcon({className:"default-marker",html:'<div style="background-color: #3388ff; width: 10px; height: 10px; border-radius: 50%; border: 3px solid #ffffff; box-shadow: 0 0 0 2px #3388ff;"></div>',iconSize:[16,16],iconAnchor:[8,8]});y.setIcon(t),y=null}}function F(t,s){let e=t.querySelector(".custom-tooltip");e||(e=document.createElement("div"),e.className="custom-tooltip",e.textContent=s,t.appendChild(e));const i=t.getBoundingClientRect(),a=e.offsetWidth,l=window.innerWidth;e.style.top="-".concat(e.offsetHeight+5,"px");let p=(t.offsetWidth-a)/2;const r=i.left;r+p<0?p=-r+5:r+p+a>l&&(p=l-r-a-5),e.style.left="".concat(p,"px"),e.style.visibility="visible",setTimeout(()=>{e.style.visibility="hidden"},3e3)}function j(t){const s=t.querySelector(".custom-tooltip");s&&(s.style.visibility="hidden")}function P(t){const s=document.getElementById("visible-places"),e=document.getElementById("outside-places");s.innerHTML="",e.innerHTML="";const i=x(),a=i.getBounds(),l=i.getCenter(),p=H(),r=t.map(n=>{const d=L.latLng(n.lat,n.lng),m=l.distanceTo(d);return{...n,distance:m}}).sort((n,d)=>n.distance-d.distance);let c=null;r.forEach(n=>{const d=document.createElement("div");d.className="place",d.innerHTML='\n      <img src="'.concat(n.image,'" alt="').concat(n.name,'" loading="lazy">\n      <div class="place-info">\n        <h3>').concat(n.name,"</h3>\n        <p>").concat(n.shirt_description||n.description,"</p>\n        <p>").concat(n.attributes.map(m=>w[m]||m).join(""),"</p>\n      </div>\n    "),d.onclick=()=>{if(window.innerWidth<=768)i.setView([n.lat,n.lng],17,{animate:!0}),z(n),R(),S(n.name);else{const m=p[n.name];m&&i.removeLayer(m),c&&(c.isPopupOpen()&&c.closePopup(),i.removeLayer(c),c=null);const A='\n          <div class="popup-content">\n            <img src="'.concat(n.image,'" alt="').concat(n.name,'">\n            <div class="popup-text">\n              <div class="popup-text-content">\n                <h3>').concat(n.name,"</h3>\n                <p>").concat(n.description,'</p>\n                <div class="popup-attributes">').concat(n.attributes.map(I=>w[I]||I).join(""),'</div>\n              </div>\n              <div class="popup-links">\n                <a href="').concat(n.instagram,'" target="_blank">\n                  <img src="https://paulbrsv.github.io/goodplaces/image/instagram.svg" alt="Instagram" class="icon">\n                </a>\n                <a href="').concat(n.maps_url,'" target="_blank">\n                  <img src="https://paulbrsv.github.io/goodplaces/image/google.svg" alt="Google Maps" class="icon">\n                </a>\n              </div>\n            </div>\n          </div>\n        ');c=L.marker([n.lat,n.lng],{icon:L.divIcon({className:"highlighted-marker",html:'<img src="https://paulbrsv.github.io/goodplaces/image/mark.svg" style="width: 48px; height: 64px;">',iconSize:[48,48],iconAnchor:[24,48]})}),c.bindPopup(A,{autoPan:!0,autoPanPaddingTopLeft:L.point(0,100),autoPanPaddingBottomRight:L.point(0,50),offset:L.point(0,-25)}),c.addTo(i).openPopup(),i.setView([n.lat,n.lng],17,{animate:!0}),S(n.name),c.on("popupclose",()=>{i.removeLayer(c),c=null,m&&i.addLayer(m),f()})}},a.contains([n.lat,n.lng])?s.appendChild(d):e.appendChild(d)})}function z(t){const s=document.getElementById("mobile-place-card"),e=s.querySelector(".mobile-place-card-header"),i=s.querySelector(".mobile-place-card-content"),a=t.attributes.map(l=>w[l]||l).join("");e.innerHTML='\n    <div class="mobile-place-card-attributes">'.concat(a,'</div>\n    <span class="close-card">✕</span>\n  '),i.innerHTML='\n    <img src="'.concat(t.image,'" alt="').concat(t.name,'">\n    <div class="popup-text">\n      <div class="popup-text-content">\n        <h3>').concat(t.name,"</h3>\n        <p>").concat(t.description,'</p>\n      </div>\n      <div class="popup-links">\n        <a href="').concat(t.instagram,'" target="_blank"><img src="https://paulbrsv.github.io/goodplaces/image/instagram.svg" alt="Instagram" class="icon"></a>\n        <a href="').concat(t.maps_url,'" target="_blank"><img src="https://paulbrsv.github.io/goodplaces/image/google.svg" alt="Google Maps" class="icon"></a>\n      </div>\n    </div>\n  '),s.classList.remove("hidden"),s.classList.add("active")}function R(){const t=document.getElementById("sidebar"),s=document.querySelector(".mobile-sidebar-close"),e=document.querySelector(".mobile-list-toggle");t.style.transform="translateX(-100%)",s.style.display="none",window.innerWidth<=768&&(e.style.display="block"),f()}let g,E=L.markerClusterGroup(),_={},k=[];function V(){return new Promise((t,s)=>{g=L.map("map").setView(v.initialCoords,v.initialZoom),L.tileLayer(v.tileLayerUrl,{attribution:v.attribution}).addTo(g),g.addLayer(E),fetch("/places.json").then(e=>e.json()).then(e=>{k=e,$(q()),t()}).catch(e=>{console.error("Ошибка загрузки данных:",e),s(e)}),g.on("moveend",()=>{k.length&&P(k.filter(e=>{const i=q();return i.length===0?!0:e.attributes.some(a=>i.includes(a))}))})})}function $(t){if(!g||!k.length){console.warn("Map or places data not ready yet, skipping updateMap");return}E.clearLayers();const s=k.filter(e=>t.length===0?!0:t.every(i=>e.attributes.includes(i)));s.forEach(e=>{const i='\n      <div class="popup-content">\n        <img src="'.concat(e.image,'" alt="').concat(e.name,'" loading="lazy">\n        <div class="popup-text">\n          <div class="popup-text-content">\n            <h3>').concat(e.name,"</h3>\n            <p>").concat(e.description,'</p>\n            <div class="popup-attributes">').concat(e.attributes.map(l=>w[l]||l).join(""),'</div>\n          </div>\n          <div class="popup-links">\n            <a href="').concat(e.instagram,'" target="_blank">\n              <img src="https://paulbrsv.github.io/goodplaces/image/instagram.svg" alt="Instagram" class="icon">\n            </a>\n            <a href="').concat(e.maps_url,'" target="_blank">\n              <img src="https://paulbrsv.github.io/goodplaces/image/google.svg" alt="Google Maps" class="icon">\n            </a>\n          </div>\n        </div>\n      </div>\n    '),a=L.marker([e.lat,e.lng],{icon:L.divIcon({className:"default-marker",html:'<div style="background-color: #3388ff; width: 10px; height: 10px; border-radius: 50%; border: 3px solid #ffffff; box-shadow: 0 0 0 2px #3388ff;"></div>',iconSize:[16,16],iconAnchor:[8,8]})});window.innerWidth>768?(a.bindPopup(i,{autoPan:!0,autoPanPaddingTopLeft:L.point(0,100),autoPanPaddingBottomRight:L.point(0,50),offset:L.point(0,-25)}),a.on("popupopen",()=>S(e.name)),a.on("popupclose",()=>f())):a.on("click",()=>{G(e),S(e.name)}),E.addLayer(a),_[e.name]=a}),g.addLayer(E),P(s),D(s)}function D(t){document.querySelectorAll(".filter").forEach(s=>{const e=s.dataset.filter;if(!e)return;const i=t.filter(l=>l.attributes.includes(e)).length;let a=s.querySelector(".filter-count");a||(a=document.createElement("div"),a.classList.add("filter-count"),s.appendChild(a)),a.textContent=i})}function G(t){const s=document.getElementById("mobile-place-card"),e=s.querySelector(".mobile-place-card-header"),i=s.querySelector(".mobile-place-card-content"),a=t.attributes.map(l=>w[l]||l).join("");e.innerHTML='\n    <div class="mobile-place-card-attributes">'.concat(a,'</div>\n    <span class="close-card">✕</span>\n  '),i.innerHTML='\n    <img src="'.concat(t.image,'" alt="').concat(t.name,'">\n    <div class="popup-text">\n      <div class="popup-text-content">\n        <h3>').concat(t.name,"</h3>\n        <p>").concat(t.description,'</p>\n      </div>\n      <div class="popup-links">\n        <a href="').concat(t.instagram,'" target="_blank"><img src="https://paulbrsv.github.io/goodplaces/image/instagram.svg" alt="Instagram" class="icon"></a>\n        <a href="').concat(t.maps_url,'" target="_blank"><img src="https://paulbrsv.github.io/goodplaces/image/google.svg" alt="Google Maps" class="icon"></a>\n      </div>\n    </div>\n  '),s.classList.remove("hidden"),s.classList.add("active")}function H(){return _}function x(){return g}let o=[];function U(){document.querySelectorAll(".filter").forEach(t=>{var a,l;const s=t.dataset.filter;if(!s)return;t.innerHTML="";const e=document.createElement("span");e.className="filter-icon-wrapper";const i=document.createElement("img");i.src=B[s]||"https://via.placeholder.com/16",i.alt=((a=M[s])==null?void 0:a[u])||s,i.className="filter-icon",e.appendChild(i),t.appendChild(e),t.appendChild(document.createTextNode(((l=M[s])==null?void 0:l[u])||s)),t.addEventListener("click",()=>{o.includes(s)?(o=o.filter(p=>p!==s),t.classList.remove("active")):(o.push(s),t.classList.add("active")),f(),$(o),C()}),o.includes(s)&&t.classList.add("active")}),document.querySelectorAll(".filter-reset").forEach(t=>{t.addEventListener("click",()=>{o=[],document.querySelectorAll(".filter").forEach(s=>s.classList.remove("active")),f(),x().setView(v.initialCoords,v.initialZoom),$(o),C()})})}function X(t){o=t.filter(s=>B[s]),console.log("Setting active filters:",o),o.forEach(s=>{const e=document.querySelector('.filter[data-filter="'.concat(s,'"]'));e?(console.log("Activating filter: ".concat(s)),e.classList.add("active")):console.warn('Filter "'.concat(s,'" not found in DOM'))}),o.length>0&&($(o),C())}function O(){document.querySelectorAll(".filter").forEach(t=>{const s=t.dataset.filter;s&&(o.includes(s)?(console.log("Updating visual state for: ".concat(s)),t.classList.add("active")):t.classList.remove("active"))})}function q(){return o}function C(){const t=new URL(window.location);o.length>0?t.search="?filter=".concat(o.join(",")):t.search="",window.history.pushState({},document.title,t)}function Z(){document.querySelector(".mobile-list-toggle").addEventListener("click",()=>{const e=document.getElementById("sidebar"),i=document.querySelector(".mobile-sidebar-close");e.style.transform==="translateX(-100%)"||e.classList.contains("hidden-mobile")?(e.style.transform="translateX(0)",e.classList.remove("hidden-mobile"),e.scrollTop=0,window.innerWidth<=768&&(i.style.display="flex",document.querySelector(".mobile-list-toggle").style.display="none")):T()}),document.querySelector(".mobile-sidebar-close").addEventListener("click",T),document.getElementById("mobile-place-card").addEventListener("click",e=>{if(e.target.classList.contains("close-card")){const i=document.getElementById("mobile-place-card");i.classList.remove("active"),setTimeout(()=>{i.classList.add("hidden"),f()},300)}});const t=document.querySelector(".mobile-list-toggle"),s=()=>{window.innerWidth>768?t.style.display="none":t.style.display="block"};s(),window.addEventListener("resize",s)}function T(){const t=document.getElementById("sidebar"),s=document.querySelector(".mobile-sidebar-close"),e=document.querySelector(".mobile-list-toggle");t.style.transform="translateX(-100%)",s.style.display="none",window.innerWidth<=768&&(e.style.display="block"),f()}function J(){document.querySelector(".more-filters-btn").addEventListener("click",()=>{document.getElementById("more-filters-modal").classList.remove("hidden")}),document.querySelector(".close-modal").addEventListener("click",()=>{document.getElementById("more-filters-modal").classList.add("hidden")})}const K='<div class="filters">\n  <div class="filters-mobile">\n    <div class="filter-row">\n      <span class="filter" data-filter="no_smoking"></span>\n      <span class="filter" data-filter="terrace"></span>\n      <span class="more-filters-btn">\n        <!-- Текст "Ещё" добавится через JS -->\n      </span>\n    </div>\n    <div class="filter-row">\n      <span class="filter" data-filter="coffee_shop"></span>\n      <span class="filter" data-filter="breakfast"></span>\n      <span class="filter" data-filter="bar"></span>\n      <span class="filter-reset">\n        <img src="https://paulbrsv.github.io/goodplaces/image/reset.svg" alt="Reset" class="filter-icon">\n      </span>\n    </div>\n  </div>\n  <div class="filters-left">\n    <span class="filter" data-filter="no_smoking"></span>\n    <span class="filter" data-filter="pets_allowed"></span>\n    <span class="filter" data-filter="terrace"></span>\n    <span class="filter" data-filter="smoke"></span>\n\n  </div>\n  <span class="filter-divider"></span>\n  <div class="filters-right">\n    <span class="filter" data-filter="coffee_shop"></span>\n    <span class="filter" data-filter="specialty"></span>\n    <span class="filter" data-filter="food"></span>\n    <span class="filter" data-filter="bar"></span>\n    <span class="filter" data-filter="desserts"></span>\n    <span class="filter" data-filter="breakfast"></span>\n    <span class="filter" data-filter="cafe"></span>\n    <span class="filter" data-filter="vegan"></span>\n    <span class="filter" data-filter="snacks"></span>\n    <span class="filter" data-filter="beans_sale"></span>\n    <span class="filter" data-filter="ice_cream"></span>\n    <span class="filter" data-filter="beer"></span>\n    <span class="filter" data-filter="wine"></span>\n  </div>\n  <span class="filter-reset desktop-reset">\n    <img src="https://paulbrsv.github.io/goodplaces/image/reset.svg" alt="Reset" class="filter-icon">\n  </span>\n</div>\n',Q='<div id="sidebar" class="hidden-mobile">\n  <div class="place-list">\n    <h3>В этом районе</h3>\n    <div id="visible-places"></div>\n  </div>\n  <div class="place-list">\n    <h3>📍 Ещё рядом</h3>\n    <div id="outside-places"></div>\n  </div>\n</div>\n',Y='<div id="map"></div>\n',ee='<button class="mobile-sidebar-close" style="display: none;">\n  <img src="https://paulbrsv.github.io/goodplaces/image/close.svg" alt="Close" class="icon">\n  Закрыть\n</button>\n<div class="mobile-list-toggle">\n  <img src="https://paulbrsv.github.io/goodplaces/image/list.svg" alt="List" class="icon">\n  Показать список\n</div>\n<div id="mobile-place-card" class="mobile-place-card hidden">\n  <div class="mobile-place-card-header">\n    <div class="mobile-place-card-attributes"></div>\n    <span class="close-card">✕</span>\n  </div>\n  <div class="mobile-place-card-content"></div>\n</div>\n',te='<div id="more-filters-modal" class="modal hidden">\n  <div class="modal-content">\n    <span class="close-modal">✕</span>\n    <div class="extra-filters">\n      <div class="extra-filters-top">\n        <span class="filter" data-filter="smoke"></span>\n        <span class="filter" data-filter="pets_allowed"></span>\n      </div>\n      <span class="filter-divider-horizontal"></span>\n      <div class="extra-filters-bottom">\n        <span class="filter" data-filter="specialty"></span>\n        <span class="filter" data-filter="food"></span>\n        <span class="filter" data-filter="desserts"></span>\n        <span class="filter" data-filter="cafe"></span>\n        <span class="filter" data-filter="vegan"></span>\n        <span class="filter" data-filter="snacks"></span>\n        <span class="filter" data-filter="wine"></span>\n        <span class="filter" data-filter="beans_sale"></span>\n        <span class="filter" data-filter="ice_cream"></span>\n        <span class="filter" data-filter="beer"></span>\n\n      </div>\n    </div>\n  </div>\n</div>\n';function h(t,s){document.getElementById(t).innerHTML=s}async function se(){h("header-container",W),h("filters-container",K),h("sidebar-container",Q),h("map-container",Y),h("mobile-container",ee),h("modal-container",te);const t=document.getElementById("filters-container");document.getElementById("filters-placeholder").appendChild(t.querySelector(".filters")),t.innerHTML="",document.querySelector("h1").textContent=b.headerTitle[u],document.querySelector(".mobile-list-toggle").lastChild.textContent=b.showListButton[u],document.querySelector(".mobile-sidebar-close").lastChild.textContent=b.closeButton[u];const e=document.querySelector(".more-filters-btn");e.innerHTML="";const i=document.createElement("img");i.src="https://paulbrsv.github.io/goodplaces/image/more.svg",i.alt=b.moreFilters[u],i.className="filter-icon",e.appendChild(i),e.appendChild(document.createTextNode(b.moreFilters[u])),U(),await V(),Z(),J();const l=new URLSearchParams(window.location.search).get("filter");if(l){const r=l.split(",");X(r)}O(),document.querySelectorAll(".filter").forEach(r=>{const c=r.dataset.filter;if(!c)return;const d=(N[c]||{})[u]||"Description unavailable";r.addEventListener("mouseenter",()=>F(r,d)),r.addEventListener("mouseleave",()=>j(r))})}document.addEventListener("DOMContentLoaded",se);export{ie as __vite_legacy_guard};
