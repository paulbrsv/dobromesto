import{a as w,m as h,f as B,b as M,c as f,u as b,d as A,h as N}from"./header-B6lkl4WX.js";function ne(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}let y=null;function S(e){y&&u();const s=H();if(s[e]){const t=s[e],n=L.divIcon({className:"highlighted-marker",html:'<img src="/images/mark.svg" style="width: 48px; height: 64px;">',iconSize:[48,48],iconAnchor:[24,48]});t.setIcon(n),y=t,x().setView(t.getLatLng(),x().getZoom(),{animate:!0})}}function u(){if(y){const e=L.divIcon({className:"default-marker",html:'<div style="background-color: #3388ff; width: 10px; height: 10px; border-radius: 50%; border: 3px solid #ffffff; box-shadow: 0 0 0 2px #3388ff;"></div>',iconSize:[16,16],iconAnchor:[8,8]});y.setIcon(e),y=null}}function F(e,s){let t=e.querySelector(".custom-tooltip");t||(t=document.createElement("div"),t.className="custom-tooltip",t.textContent=s,e.appendChild(t));const n=e.getBoundingClientRect(),a=t.offsetWidth,l=window.innerWidth;t.style.top="-".concat(t.offsetHeight+5,"px");let m=(e.offsetWidth-a)/2;const r=n.left;r+m<0?m=-r+5:r+m+a>l&&(m=l-r-a-5),t.style.left="".concat(m,"px"),t.style.visibility="visible",setTimeout(()=>{t.style.visibility="hidden"},3e3)}function j(e){const s=e.querySelector(".custom-tooltip");s&&(s.style.visibility="hidden")}function P(e){const s=document.getElementById("visible-places"),t=document.getElementById("outside-places");s.innerHTML="",t.innerHTML="";const n=x(),a=n.getBounds(),l=n.getCenter(),m=H(),r=e.map(i=>{const d=L.latLng(i.lat,i.lng),p=l.distanceTo(d);return{...i,distance:p}}).sort((i,d)=>i.distance-d.distance);let c=null;r.forEach(i=>{const d=document.createElement("div");d.className="place",d.innerHTML='\n      <img src="'.concat(i.image,'" alt="').concat(i.name,'" loading="lazy">\n      <div class="place-info">\n        <h3>').concat(i.name,"</h3>\n        <p>").concat(i.shirt_description||i.description,"</p>\n        <p>").concat(i.attributes.map(p=>w[p]||p).join(""),"</p>\n      </div>\n    "),d.onclick=()=>{if(window.innerWidth<=768)n.setView([i.lat,i.lng],18,{animate:!0}),z(i),R(),S(i.name);else{const p=m[i.name];p&&n.removeLayer(p),c&&(c.isPopupOpen()&&c.closePopup(),n.removeLayer(c),c=null);const W='\n          <div class="popup-content">\n            <img src="'.concat(i.image,'" alt="').concat(i.name,'">\n            <div class="popup-text">\n              <div class="popup-text-content">\n                <h3>').concat(i.name,"</h3>\n                <p>").concat(i.description,'</p>\n                <div class="popup-attributes">').concat(i.attributes.map(I=>w[I]||I).join(""),'</div>\n              </div>\n              <div class="popup-links">\n                <a href="').concat(i.instagram,'" target="_blank">\n                  <img src="/images/instagram.svg" alt="Instagram" class="icon">\n                </a>\n                <a href="').concat(i.maps_url,'" target="_blank">\n                  <img src="/images/google.svg" alt="Google Maps" class="icon">\n                </a>\n              </div>\n            </div>\n          </div>\n        ');c=L.marker([i.lat,i.lng],{icon:L.divIcon({className:"highlighted-marker",html:'<img src="/images/mark.svg" style="width: 48px; height: 64px;">',iconSize:[48,48],iconAnchor:[24,48]})}),c.bindPopup(W,{autoPan:!0,autoPanPaddingTopLeft:L.point(0,100),autoPanPaddingBottomRight:L.point(0,50),offset:L.point(0,-25)}),c.addTo(n).openPopup(),n.setView([i.lat,i.lng],17,{animate:!0}),S(i.name),c.on("popupclose",()=>{n.removeLayer(c),c=null,p&&n.addLayer(p),u()})}},a.contains([i.lat,i.lng])?s.appendChild(d):t.appendChild(d)})}function z(e){const s=document.getElementById("mobile-place-card"),t=s.querySelector(".mobile-place-card-header"),n=s.querySelector(".mobile-place-card-content"),a=e.attributes.map(l=>w[l]||l).join("");t.innerHTML='\n    <div class="mobile-place-card-attributes">'.concat(a,'</div>\n    <span class="close-card">✕</span>\n  '),n.innerHTML='\n    <img src="'.concat(e.image,'" alt="').concat(e.name,'">\n    <div class="popup-text">\n      <div class="popup-text-content">\n        <h3>').concat(e.name,"</h3>\n        <p>").concat(e.description,'</p>\n      </div>\n      <div class="popup-links">\n        <a href="').concat(e.instagram,'" target="_blank"><img src="/images/instagram.svg" alt="Instagram" class="icon"></a>\n        <a href="').concat(e.maps_url,'" target="_blank"><img src="/images/google.svg" alt="Google Maps" class="icon"></a>\n      </div>\n    </div>\n  '),s.classList.remove("hidden"),s.classList.add("active")}function R(){const e=document.getElementById("sidebar"),s=document.querySelector(".mobile-sidebar-close"),t=document.querySelector(".mobile-list-toggle");e.style.transform="translateX(-100%)",s.style.display="none",window.innerWidth<=768&&(t.style.display="block"),u()}let g,E=L.markerClusterGroup(),_={},k=[];function V(){return new Promise((e,s)=>{g=L.map("map").setView(h.initialCoords,h.initialZoom),L.tileLayer(h.tileLayerUrl,{attribution:h.attribution}).addTo(g),g.addLayer(E),fetch("/places.json").then(t=>t.json()).then(t=>{k=t,$(q()),e()}).catch(t=>{console.error("Ошибка загрузки данных:",t),s(t)}),g.on("moveend",()=>{k.length&&P(k.filter(t=>{const n=q();return n.length===0?!0:t.attributes.some(a=>n.includes(a))}))})})}function $(e){if(!g||!k.length){console.warn("Map or places data not ready yet, skipping updateMap");return}E.clearLayers();const s=k.filter(t=>e.length===0?!0:e.every(n=>t.attributes.includes(n)));s.forEach(t=>{const n='\n      <div class="popup-content">\n        <img src="'.concat(t.image,'" alt="').concat(t.name,'" loading="lazy">\n        <div class="popup-text">\n          <div class="popup-text-content">\n            <h3>').concat(t.name,"</h3>\n            <p>").concat(t.description,'</p>\n            <div class="popup-attributes">').concat(t.attributes.map(l=>w[l]||l).join(""),'</div>\n          </div>\n          <div class="popup-links">\n            <a href="').concat(t.instagram,'" target="_blank">\n              <img src="/images/instagram.svg" alt="Instagram" class="icon">\n            </a>\n            <a href="').concat(t.maps_url,'" target="_blank">\n              <img src="/images/google.svg" alt="Google Maps" class="icon">\n            </a>\n          </div>\n        </div>\n      </div>\n    '),a=L.marker([t.lat,t.lng],{icon:L.divIcon({className:"default-marker",html:'<div style="background-color: #3388ff; width: 10px; height: 10px; border-radius: 50%; border: 3px solid #ffffff; box-shadow: 0 0 0 2px #3388ff;"></div>',iconSize:[16,16],iconAnchor:[8,8]})});window.innerWidth>768?(a.bindPopup(n,{autoPan:!0,autoPanPaddingTopLeft:L.point(0,100),autoPanPaddingBottomRight:L.point(0,50),offset:L.point(0,-25)}),a.on("popupopen",()=>S(t.name)),a.on("popupclose",()=>u())):a.on("click",()=>{G(t),S(t.name)}),E.addLayer(a),_[t.name]=a}),g.addLayer(E),P(s),D(s)}function D(e){document.querySelectorAll(".filter").forEach(s=>{const t=s.dataset.filter;if(!t)return;const n=e.filter(l=>l.attributes.includes(t)).length;let a=s.querySelector(".filter-count");a||(a=document.createElement("div"),a.classList.add("filter-count"),s.appendChild(a)),a.textContent=n})}function G(e){const s=document.getElementById("mobile-place-card"),t=s.querySelector(".mobile-place-card-header"),n=s.querySelector(".mobile-place-card-content"),a=e.attributes.map(l=>w[l]||l).join("");t.innerHTML='\n    <div class="mobile-place-card-attributes">'.concat(a,'</div>\n    <span class="close-card">✕</span>\n  '),n.innerHTML='\n    <img src="'.concat(e.image,'" alt="').concat(e.name,'">\n    <div class="popup-text">\n      <div class="popup-text-content">\n        <h3>').concat(e.name,"</h3>\n        <p>").concat(e.description,'</p>\n      </div>\n      <div class="popup-links">\n        <a href="').concat(e.instagram,'" target="_blank"><img src="/images/instagram.svg" alt="Instagram" class="icon"></a>\n        <a href="').concat(e.maps_url,'" target="_blank"><img src="/images/google.svg" alt="Google Maps" class="icon"></a>\n      </div>\n    </div>\n  '),s.classList.remove("hidden"),s.classList.add("active")}function H(){return _}function x(){return g}let o=[];function U(){document.querySelectorAll(".filter").forEach(e=>{var a,l;const s=e.dataset.filter;if(!s)return;e.innerHTML="";const t=document.createElement("span");t.className="filter-icon-wrapper";const n=document.createElement("img");n.src=B[s]||"https://via.placeholder.com/16",n.alt=((a=M[s])==null?void 0:a[f])||s,n.className="filter-icon",t.appendChild(n),e.appendChild(t),e.appendChild(document.createTextNode(((l=M[s])==null?void 0:l[f])||s)),e.addEventListener("click",()=>{o.includes(s)?(o=o.filter(m=>m!==s),e.classList.remove("active")):(o.push(s),e.classList.add("active")),u(),$(o),C()}),o.includes(s)&&e.classList.add("active")}),document.querySelectorAll(".filter-reset").forEach(e=>{e.addEventListener("click",()=>{o=[],document.querySelectorAll(".filter").forEach(s=>s.classList.remove("active")),u(),x().setView(h.initialCoords,h.initialZoom),$(o),C()})})}function X(e){o=e.filter(s=>B[s]),console.log("Setting active filters:",o),o.forEach(s=>{const t=document.querySelector('.filter[data-filter="'.concat(s,'"]'));t?(console.log("Activating filter: ".concat(s)),t.classList.add("active")):console.warn('Filter "'.concat(s,'" not found in DOM'))}),o.length>0&&($(o),C())}function O(){document.querySelectorAll(".filter").forEach(e=>{const s=e.dataset.filter;s&&(o.includes(s)?(console.log("Updating visual state for: ".concat(s)),e.classList.add("active")):e.classList.remove("active"))})}function q(){return o}function C(){const e=new URL(window.location);o.length>0?e.search="?filter=".concat(o.join(",")):e.search="",window.history.pushState({},document.title,e)}function Z(){document.querySelector(".mobile-list-toggle").addEventListener("click",()=>{const t=document.getElementById("sidebar"),n=document.querySelector(".mobile-sidebar-close");t.style.transform==="translateX(-100%)"||t.classList.contains("hidden-mobile")?(t.style.transform="translateX(0)",t.classList.remove("hidden-mobile"),t.scrollTop=0,window.innerWidth<=768&&(n.style.display="flex",document.querySelector(".mobile-list-toggle").style.display="none")):T()}),document.querySelector(".mobile-sidebar-close").addEventListener("click",T),document.getElementById("mobile-place-card").addEventListener("click",t=>{if(t.target.classList.contains("close-card")){const n=document.getElementById("mobile-place-card");n.classList.remove("active"),setTimeout(()=>{n.classList.add("hidden"),u()},300)}});const e=document.querySelector(".mobile-list-toggle"),s=()=>{window.innerWidth>768?e.style.display="none":e.style.display="block"};s(),window.addEventListener("resize",s)}function T(){const e=document.getElementById("sidebar"),s=document.querySelector(".mobile-sidebar-close"),t=document.querySelector(".mobile-list-toggle");e.style.transform="translateX(-100%)",s.style.display="none",window.innerWidth<=768&&(t.style.display="block"),u()}function J(){document.querySelector(".more-filters-btn").addEventListener("click",()=>{document.getElementById("more-filters-modal").classList.remove("hidden")}),document.querySelector(".close-modal").addEventListener("click",()=>{document.getElementById("more-filters-modal").classList.add("hidden")})}const K='<div class="filters">\n  <div class="filters-mobile">\n    <div class="filter-row">\n      <span class="filter" data-filter="no_smoking"></span>\n      <span class="filter" data-filter="terrace"></span>\n      <span class="more-filters-btn">\n        <!-- Текст "Ещё" добавится через JS -->\n      </span>\n    </div>\n    <div class="filter-row">\n      <span class="filter" data-filter="coffee_shop"></span>\n      <span class="filter" data-filter="breakfast"></span>\n      <span class="filter" data-filter="bar"></span>\n      <span class="filter-reset">\n        <img src="/images/reset.svg" alt="Reset" class="filter-icon">\n      </span>\n    </div>\n  </div>\n  <div class="filters-left">\n    <span class="filter" data-filter="no_smoking"></span>\n    <span class="filter" data-filter="pets_allowed"></span>\n    <span class="filter" data-filter="terrace"></span>\n    <span class="filter" data-filter="smoke"></span>\n\n  </div>\n  <span class="filter-divider"></span>\n  <div class="filters-right">\n    <span class="filter" data-filter="coffee_shop"></span>\n    <span class="filter" data-filter="specialty"></span>\n    <span class="filter" data-filter="food"></span>\n    <span class="filter" data-filter="bar"></span>\n    <span class="filter" data-filter="desserts"></span>\n    <span class="filter" data-filter="breakfast"></span>\n    <span class="filter" data-filter="cafe"></span>\n    <span class="filter" data-filter="vegan"></span>\n    <span class="filter" data-filter="snacks"></span>\n    <span class="filter" data-filter="beans_sale"></span>\n    <span class="filter" data-filter="ice_cream"></span>\n    <span class="filter" data-filter="beer"></span>\n    <span class="filter" data-filter="wine"></span>\n  </div>\n  <span class="filter-reset desktop-reset">\n    <img src="/images/reset.svg" alt="Reset" class="filter-icon">\n  </span>\n</div>\n',Q='<div id="sidebar" class="hidden-mobile">\n  <div class="place-list">\n    <h3>В этом районе</h3>\n    <div id="visible-places"></div>\n  </div>\n  <div class="place-list">\n    <h3>📍 Ещё рядом</h3>\n    <div id="outside-places"></div>\n  </div>\n</div>\n',Y='<div id="map"></div>\n',ee='<button class="mobile-sidebar-close" style="display: none;">\n  <img src="/images/close.svg" alt="Close" class="icon">\n  Закрыть\n</button>\n<div class="mobile-list-toggle">\n  <img src="/images/list.svg" alt="List" class="icon">\n  Показать список\n</div>\n<div id="mobile-place-card" class="mobile-place-card hidden">\n  <div class="mobile-place-card-header">\n    <div class="mobile-place-card-attributes"></div>\n    <span class="close-card">✕</span>\n  </div>\n  <div class="mobile-place-card-content"></div>\n</div>\n',te='<div id="more-filters-modal" class="modal hidden">\n  <div class="modal-content">\n    <span class="close-modal">✕</span>\n    <div class="extra-filters">\n      <div class="extra-filters-top">\n        <span class="filter" data-filter="smoke"></span>\n        <span class="filter" data-filter="pets_allowed"></span>\n      </div>\n      <span class="filter-divider-horizontal"></span>\n      <div class="extra-filters-bottom">\n        <span class="filter" data-filter="specialty"></span>\n        <span class="filter" data-filter="food"></span>\n        <span class="filter" data-filter="desserts"></span>\n        <span class="filter" data-filter="cafe"></span>\n        <span class="filter" data-filter="vegan"></span>\n        <span class="filter" data-filter="snacks"></span>\n        <span class="filter" data-filter="wine"></span>\n        <span class="filter" data-filter="beans_sale"></span>\n        <span class="filter" data-filter="ice_cream"></span>\n        <span class="filter" data-filter="beer"></span>\n\n      </div>\n    </div>\n  </div>\n</div>\n';function v(e,s){document.getElementById(e).innerHTML=s}async function se(){v("header-container",N),v("filters-container",K),v("sidebar-container",Q),v("map-container",Y),v("mobile-container",ee),v("modal-container",te);const e=document.getElementById("filters-container");document.getElementById("filters-placeholder").appendChild(e.querySelector(".filters")),e.innerHTML="",document.querySelector("h1").textContent=b.headerTitle[f],document.querySelector(".mobile-list-toggle").lastChild.textContent=b.showListButton[f],document.querySelector(".mobile-sidebar-close").lastChild.textContent=b.closeButton[f];const t=document.querySelector(".more-filters-btn");t.innerHTML="";const n=document.createElement("img");n.src="/images/more.svg",n.alt=b.moreFilters[f],n.className="filter-icon",t.appendChild(n),t.appendChild(document.createTextNode(b.moreFilters[f])),U(),await V(),Z(),J();const l=new URLSearchParams(window.location.search).get("filter");if(l){const r=l.split(",");X(r)}O(),document.querySelectorAll(".filter").forEach(r=>{const c=r.dataset.filter;if(!c)return;const d=(A[c]||{})[f]||"Description unavailable";r.addEventListener("mouseenter",()=>F(r,d)),r.addEventListener("mouseleave",()=>j(r))})}document.addEventListener("DOMContentLoaded",se);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker зарегистрирован:",e.scope)}).catch(e=>{console.error("Ошибка регистрации Service Worker:",e)})});export{ne as __vite_legacy_guard};
